<div>
  
  <h2>Auditorias</h2>
 
  <!--Panel de Warning: Permisos-->
  <div class="panel panel-warning" ng-hide="tengoPermiso('generar_auditoria');">
    <div class="panel-heading">
        No tiene permisos suficientes para acceder a esta funcionalidad.
    </div>
  </div>
  <!--Auditoria-->  
  <div class="panel panel-success" ng-show="tengoPermiso('generar_auditoria');">
    <div class="panel-heading">
        Seleccione uno de los filtros para ver las auditorias del sistema:
  </div>
  
  <div class="panel-body"> 
    <div class="row">   
      
      <!--Filtro-->
      <div class="col-xs-6 col-md-4">
          <select class="form-control input-sm" data-style="btn-default" placeholder="Filtro" 
          name="filtro" ng-focus="onFocusDeFiltro();" data-live-search="true" ng-model="dataListaFiltro.seleccionado" ng-options="filtro.nombre for filtro in dataListaFiltro.opciones track by filtro.nombre" required>
          </select>
      </div>

       <!--Form xa Filtro de Fecha-->
      <form role="form" name="fechaform">
      <!--Fecha Desde-->       
      <div class="col-xs-6 col-md-4" ng-show="dataListaFiltro.seleccionado.nombre == 'fecha';">
          <div class="form-group has-feedback"  novalidate> 
                <input class="form-control" 
                placeholder="desde (DD/MM/YYYY)" name="desde"  autocomplete="off" ng-model="desde" 
                ng-pattern="/^(0?[1-9]|1\d|2[0-8]|29(?=[/]\d?\d[/](?!1[01345789]00|2[1235679]00)\d\d(?:[02468][048]|[13579][26]))|30(?![/]0?2)|31(?=[/]0?[13578]|[/]1[02]))[/](0?[1-9]|1[0-2])[/]([12]\d{3})$/" required>
                <!-- Validacion Requerido-->
                <span class="help-block" 
                ng-show="fechaform.desde.$touched && fechaform.desde.$error.required && 
                dataListaFiltro.seleccionado.nombre == 'fecha';" >Ingrese una fecha.</span>
                <!-- Validacion Patron del formato-->
                <span class="help-block" 
                ng-show="fechaform.desde.$touched && fechaform.desde.$error.pattern 
                && dataListaFiltro.seleccionado.nombre == 'fecha';" >Formato fecha invalido.</span>

                <span class="help-block" 
                ng-show=  "fechaform.desde.$touched && fechaform.hasta.$touched &&
                fechaform.desde.$valid && fechaform.hasta.$valid  && fechaPosterior();" >Rango inválido.</span>

                <!-- Validacion Error -->
                <span class="glyphicon glyphicon-remove form-control-feedback" 
                ng-show="fechaform.desde.$touched && (!fechaform.desde.$valid || fechaPosterior());"></span>

                <!-- Validacion Ok -->
                <span class="glyphicon glyphicon-ok form-control-feedback" 
                ng-show="fechaform.desde.$touched && fechaform.desde.$valid && 
                !fechaPosterior();"></span>

          </div> 
      </div>
      <!--Fecha Hasta-->
      <div class="col-xs-6 col-md-4" ng-show="dataListaFiltro.seleccionado.nombre == 'fecha';">
          <div class="form-group has-feedback" novalidate>
                <input class="form-control" 
                placeholder="hasta (DD/MM/YYYY)" autocomplete="off"  name="hasta"  ng-model="hasta" 
                ng-pattern="/^(0?[1-9]|1\d|2[0-8]|29(?=[/]\d?\d[/](?!1[01345789]00|2[1235679]00)\d\d(?:[02468][048]|[13579][26]))|30(?![/]0?2)|31(?=[/]0?[13578]|[/]1[02]))[/](0?[1-9]|1[0-2])[/]([12]\d{3})$/" required>
                <!-- Validacion Requerido-->
                <span class="help-block" 
                ng-show="fechaform.hasta.$touched && fechaform.hasta.$error.required && 
                dataListaFiltro.seleccionado.nombre == 'fecha';" >Ingrese una fecha.</span>
                <!-- Validacion Patron del formato-->
                <span class="help-block" ng-show="fechaform.hasta.$touched && fechaform.hasta.$error.pattern 
                && dataListaFiltro.seleccionado.nombre == 'fecha';">Formato fecha invalido.</span>

                <span class="help-block" 
                ng-show=  "fechaform.hasta.$touched && fechaform.hasta.$touched &&
                fechaform.desde.$valid && fechaform.hasta.$valid  && fechaPosterior();" >Rango inválido.</span>

                <!-- Validacion Error -->
                <span class="glyphicon glyphicon-remove form-control-feedback" 
                ng-show="fechaform.hasta.$touched && (!fechaform.hasta.$valid || fechaPosterior());"></span>

                <!-- Validacion Ok -->
                <span class="glyphicon glyphicon-ok form-control-feedback" 
                ng-show="fechaform.hasta.$touched && fechaform.hasta  .$valid && 
                !fechaPosterior();"></span>

          </div>
      </div>
      </form>
      <!--Form xa Filtro de Tecnico-->
      <form role="form" name="tecnicoForm">
      <div class="col-xs-6 col-md-4" 
      ng-show="dataListaFiltro.seleccionado.nombre == 'técnico';" >          
          <div class="form-group has-feedback"  novalidate>    
            <select ng-model="tecnicos.seleccionado" placeholder="Técnico" 
            class="form-control input-sm" ng-focus="onFocusDeTecnicos();" 
            ng-options="tecnico.usuario for tecnico in tecnicos.opciones track by tecnico.usuario" name="tecnico" required>
            </select>
              <!-- Validacion Requerido-->
              <span class="help-block" 
              ng-show="tecnicoForm.tecnico.$touched && tecnicoForm.tecnico.$error.required && 
              dataListaFiltro.seleccionado.nombre == 'técnico';" >Seleccione un técnico.</span>
                <!-- Validacion Error -->
                <span class="glyphicon glyphicon-remove form-control-feedback" ng-show="filtroform.tecnico.$touched
                && !tecnicoForm.tecnico.$valid && dataListaFiltro.seleccionado.nombre == 'técnico';"></span>
                <!-- Validacion Ok -->
                <span class="glyphicon glyphicon-ok form-control-feedback" 
                ng-show="tecnicoForm.tecnico.$touched 
                && tecnicoForm.tecnico.$valid && dataListaFiltro.seleccionado.nombre == 'técnico';"></span>
          </div>
      </div> 
      </form> 
      <!--Form xa Filtro de Tipo de Accion-->
      <form role="form" name="tipoAccionForm">   
      <div class="col-xs-6 col-md-4" 
      ng-show="dataListaFiltro.seleccionado.nombre == 'tipo de acción';">
        <div class="form-group has-feedback"  novalidate>    
          <select ng-model="dataListaTipoAcciones.seleccionado" placeholder="Tipo de acción" class="form-control input-sm" ng-options="tipoAccion.nombre for tipoAccion in dataListaTipoAcciones.opciones track by tipoAccion.nombre" name="tipoaccion" required>
          </select>
             <!-- Validacion Requerido-->
              <span class="help-block" 
              ng-show="tipoAccionForm.tipoaccion.$touched && tipoAccionForm.tipoaccion.$error.required && 
              dataListaFiltro.seleccionado.nombre == 'tipo de acción';" >Seleccione un tipo de acción.</span>
                <!-- Validacion Error -->
                <span class="glyphicon glyphicon-remove form-control-feedback" ng-show="tipoAccionForm.tipoaccion.$touched
                && !tipoAccionForm.tipoaccion.$valid && dataListaFiltro.seleccionado.nombre == 'tipo de acción';"></span>
                <!-- Validacion Ok -->
                <span class="glyphicon glyphicon-ok form-control-feedback" 
                ng-show="tipoAccionForm.tipoaccion.$touched 
                && tipoAccionForm.tipoaccion.$valid && dataListaFiltro.seleccionado.nombre == 'tipo de acción';"></span>
          </div>
      </div>
      </form>
      <!--Form xa Filtro de Accion-->
      <form role="form" name="accionForm">   
      <div class="col-xs-6 col-md-4" 
      ng-show="dataListaFiltro.seleccionado.nombre == 'acción';">   
      <div class="form-group has-feedback"  novalidate>    
          <input class="form-control" ng-model="accion" placeholder="Acción" name="accion" autocomplete="off" required>
             <!-- Validacion Requerido-->
              <span class="help-block" 
              ng-show="accionForm.accion.$touched && accionForm.accion.$error.required && 
              dataListaFiltro.seleccionado.nombre == 'acción';" >Ingrese una acción.</span>
                <!-- Validacion Error -->
                <span class="glyphicon glyphicon-remove form-control-feedback" ng-show="accionForm.accion.$touched
                && !accionForm.accion.$valid && 
                dataListaFiltro.seleccionado.nombre == 'acción';"></span>
                <!-- Validacion Ok -->
                <span class="glyphicon glyphicon-ok form-control-feedback" 
                ng-show="accionForm.accion.$touched 
                && accionForm.accion.$valid && 
                dataListaFiltro.seleccionado.nombre == 'acción';"></span>
         </div>
      </div>
      </form>  

    <!--Boton Generar-->
      <div class="col-xs-6 col-md-4" 
      ng-show="dataListaFiltro.seleccionado.nombre == 'técnico';">
        <button type="submit" class="btn btn-default btn-md " 
        ng-disabled="!tecnicoForm.$valid"
        ng-click="listarAuditoria();">Generar
        </button>
      </div>
      <div class="col-xs-6 col-md-4" 
      ng-show="dataListaFiltro.seleccionado.nombre == 'tipo de acción';">
        <button type="submit" class="btn btn-default btn-md " 
        ng-disabled="!tipoAccionForm.$valid"
        ng-click="listarAuditoria();">Generar
        </button>
      </div>
      <div class="col-xs-6 col-md-4" 
      ng-show="dataListaFiltro.seleccionado.nombre == 'acción';">
        <button type="submit" class="btn btn-default btn-md " 
        ng-disabled="!accionForm.$valid"
        ng-click="listarAuditoria();">Generar
        </button>
      </div>

    </div>
  <!--Boton Generar xa Filtro Fecha-->
      <div class="form-group" ng-show="dataListaFiltro.seleccionado.nombre == 'fecha';">     
        <button type="submit" class="btn btn-default btn-md " 
        ng-click="listarAuditoria();" 
        ng-disabled="!fechaform.desde.$valid || !fechaform.hasta.$valid  || fechaInValida();" >Generar</button>
      </div>   
    </div>  
  </div>
  <!--Tabla de Auditorias-->
  <div class="panel panel-default" 
  ng-show="tengoPermiso('generar_auditoria');">    
    <div class="panel-body">
        <table datatable="ng" class="table table-striped table-bordered table-hover">
            <thead>
            <tr>
                <th>Fecha</th>                
                <th>Usuario</th>
                <th>Acción</th>
                <th>Descripción</th>
                <th>Tipo Acción</th>
            </tr>
            </thead>
            <tbody>
                <tr ng-repeat="registro in datos" >
                    <td>{{registro.fecha}}</td>
                    <td>{{registro.usuario}}</td>
                    <td>{{registro.accion}}</td>
                    <td>{{registro.descripcion}}</td>
                    <td>{{registro.tipo_accion}}</td>
                </tr>
            </tbody>
        </table>      
    </div>
      </div>
      </div>   
  </div>
</div>  
